<!DOCTYPE html>
<html>
<head>
  <title>My Budget App</title>
  <style>
    body { font-family: Arial; max-width: 1100px; margin: auto; padding: 20px; }
    input, select, button { margin: 4px; padding: 4px; }
    h2 { margin-top: 30px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; font-size: 12px; }
    th { background: #f4f4f4; }
  </style>
</head>
<body>

<h1>My Budget App</h1>

<!-- MONTHLY OVERVIEW -->
<h2>Monthly Overview</h2>
<label>Deposit:
  <input type="number" id="deposit">
</label>
<label>Fixed Expenses:
  <input type="number" id="fixed">
</label>
<strong>Left for Budget: $<span id="leftForBudget">0.00</span></strong>

<hr>

<!-- TRANSACTION ENTRY -->
<h2>Add Daily Transaction</h2>

<input type="date" id="date">
<select id="account">
  <option>APLE</option>
  <option>CSTCO</option>
  <option>HYTT</option>
  <option>ULTM</option>
  <option>SPHRE</option>
  <option>SVNG</option>
</select>

<select id="purchaser">
  <option>AA</option>
  <option>JJ</option>
</select>

<input placeholder="MainCat" id="maincat">
<input placeholder="SubCat" id="subcat">
<input placeholder="SubCat2" id="subcat2">
<input type="number" placeholder="Amount" id="amount">
<input placeholder="Place" id="place">
<input placeholder="Notes" id="notes">

<button onclick="addTransaction()">Add</button>

<!-- CALCULATIONS -->
<h2>Month Status</h2>
<strong>Left for Month: $<span id="leftForMonth">0.00</span></strong><br>
<strong>Daily Avg: $<span id="dailyAvg">0.00</span></strong>

<!-- TABLE -->
<h2>Daily Transactions</h2>
<button onclick="exportCSV()">Export CSV</button>

<table id="txnTable">
  <thead>
    <tr>
      <th>ID</th><th>Date</th><th>Account</th><th>Purch</th>
      <th>MainCat</th><th>SubCat</th><th>SubCat2</th>
      <th>Amount</th><th>Place</th><th>Notes</th><th>Left</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>


<script>
const OWNER = "NewbieCoder82";
const REPO  = "budget-app";      // example: "budget-app"
const BRANCH = "main";
const FILE_PATH = "data.json";  // since it's in /root

/* ===== App State ===== */
let data = null;     //holds your budget data
let fileSha = null;  //holds GitHub's file version (required for saving)
  
/* ===== Currency Helpers ===== */
const currencyFormatter = new Intl.NumberFormat("en-US", {
  style: "currency",
  currency: "USD"
});

function formatMoney(n) {
  const num = Number(n);
  if (Number.isNaN(num)) returen currencyFormatter.format(num);
}


  
/* ===== Github Token Helper ===== */
function getGitHubToken() {
  let token = localStorage.getItem("github_budget_token");
  if (!token) {
      token = prompt("Enter your GitHub sync token:");
      localStorage.setItem("github_budget_token", token);
  }
  return token;
}
  
function formatCurrency(value) {
  return currencyFormatter.format(value);
}

 
/* ===== Load Shared Data (STEP B) ===== */
async function loadData() {
  const token = getGitHubToken();

  const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

  const response = await fetch(url, {
    headers: {
      Authorization: `token ${token}`
    }
  });

  if (!response.ok) {
    alert("Failed to load data.json from GitHub");
    throw new Error("GitHub fetch failed");
  }

  const result = await response.json();

  fileSha = result.sha;
  data = JSON.parse(atob(result.content));
}
  
/* ===== Save (placeholder for now) ===== */
function save() {
  // we will replace this with GitHub API logic
}

/* ===== Calculations ===== */
function recalc() {
  const leftBudget = data.deposit - data.fixed;
  document.getElementById("leftForBudget").innerText =
    formatCurrency(leftBudget);

  const spent = data.transactions.reduce((a, b) => a + b.amount, 0);
  const leftMonth = leftBudget - spent;
  document.getElementById("leftForMonth").innerText =
    formatCurrency(leftMonth);

  const today = new Date();
  const daysInMonth = new Date(
    today.getFullYear(),
    today.getMonth() + 1,
    0
  ).getDate();
  const daysLeft = daysInMonth - today.getDate();

  document.getElementById("dailyAvg").innerText =
    daysLeft > 0 ? formatCurrency(leftMonth / daysLeft) : formatCurrency(0);
}

/* ===== Table Rendering ===== */
function renderTable() {
  const tbody = document.querySelector("#txnTable tbody");
  tbody.innerHTML = "";

  let runningLeft = data.deposit - data.fixed;

  data.transactions.forEach(t => {
    runningLeft -= t.amount;
    const r = tbody.insertRow();

    r.insertCell().innerText = t.id;
    r.insertCell().innerText = t.date;
    r.insertCell().innerText = t.account;
    r.insertCell().innerText = t.purchaser;
    r.insertCell().innerText = t.maincat || "";
    r.insertCell().innerText = t.subcat || "";
    r.insertCell().innerText = t.subcat2 || "";
    r.insertCell().innerText = formatCurrency(t.amount);
    r.insertCell().innerText = t.place || "";
    r.insertCell().innerText = t.notes || "";
    r.insertCell().innerText = formatCurrency(runningLeft);
  });
}

/* ===== Startup ===== */
(async () => {
  await loadData();
  deposit.value = data.deposit;
  fixed.value = data.fixed;
  recalc();
  renderTable();
})();
  
</script>


</body>
</html>
